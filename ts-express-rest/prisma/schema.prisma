generator client {
  provider = "prisma-client-js"
  previewFeatures = ["interactiveTransactions"]
}

datasource db {
  provider = "postgresql"
  url      = env("DB_URL")
}

model Nft {
  id        Int               @id @default(autoincrement())
  minterId  Int
  minter    UserWithPassword  @relation("Minted", fields: [minterId], references: [id])
  mintedAt  DateTime          @default(now())
  ownerId   Int
  owner     UserWithPassword  @relation("Owned", fields: [ownerId], references: [id])
  seed      String            @unique
  title     String
  trades    Trade[]
}

model UserWithPassword {
  id            Int       @id @default(autoincrement())
  createdAt     DateTime  @default(now())
  username      String    @unique
  passwordHash  String
  balance       Int       @default(0)
  ownedNfts     Nft[]     @relation("Owned")
  mintedNfts    Nft[]     @relation("Minted")
  boughtTrades  Trade[]   @relation("Bought")
  soldTrades    Trade[]   @relation("Sold")
}

model Trade {
  id          Int                @id @default(autoincrement())
  createdAt   DateTime           @default(now())
  sellerId    Int
  seller      UserWithPassword  @relation("Sold", fields: [sellerId], references: [id])
  buyerId     Int?
  buyer       UserWithPassword?  @relation("Bought", fields: [buyerId], references: [id])
  nftId       Int
  nft         Nft                @relation(fields: [nftId], references: [id])
  price       Int
  accepted    Boolean            @default(false)
  acceptedAt  DateTime?  
}